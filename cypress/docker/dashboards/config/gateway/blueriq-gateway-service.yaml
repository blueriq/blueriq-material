blueriq:
  gateway:
    oauth2:
      registration-extensions:
        keycloak:
          end-session-endpoint: http://localhost:8080/realms/Blueriq/protocol/openid-connect/logout
spring:
  data:
    redis:
      host: e2e-redis
      port: 6379
      password: blueriq
  cloud:
    gateway:
      x-forwarded:
        enabled: true
      forwarded:
        enabled: true
      default-filters:
        - TokenRelay
      routes:
        - id: runtime
          uri: http://e2e-runtime:8080
          predicates:
            - Path=/runtime/**
          filters:
            - WidgetSession=/runtime
        - id: dashboard
          uri: http://e2e-dashboard:8080
          predicates:
            - Path=/dashboards/**
        - id: keycloak
          uri: http://e2e-keycloak:8080
          predicates:
            - Path=/realms/**, /resources/**
          filters:
            - RewriteLocationResponseHeader=AS_IN_REQUEST, Location, ,
            - BackendForFrontend
  security:
    oauth2:
      client:
        provider:
          local-keycloak-provider:
            client-name: Keycloak-Login
            # When the issuer-uri is not set the authorization-uri and jwk-set-uri need to be set and either the token-uri or the user-info-uri
            # We cannot set the issuer-uri due to that the gateway is not able to resolve the correct issuer from within our gateway.
            # We set the token-uri, because the user-info-uri results into an error when verifying the issuer.
            token-uri: http://localhost:8080/realms/Blueriq/protocol/openid-connect/token
            authorization-uri: http://localhost:8080/realms/Blueriq/protocol/openid-connect/auth
            jwk-set-uri: http://localhost:8080/realms/Blueriq/protocol/openid-connect/certs
            # Set the user-name-attribute to which result in a default user's name of the full name is not set.
            user-name-attribute: preferred_username
        registration:
          keycloak:
            provider: local-keycloak-provider
            # Both scope openid and profile need to be active to retrieve the full information of the user.
            scope: openid, profile
            client-id: blueriq-gateway-client
            client-secret: 0Hv2WMsjIsBdHsAq3bNycIEKgCWaluEf
            authorization-grant-type: authorization_code
            redirect-uri: "{baseScheme}://{baseHost}{basePort}{basePath}/login/oauth2/code/keycloak"
server:
  forward-headers-strategy: NATIVE
  use-forward-headers: true
